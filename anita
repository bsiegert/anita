#!/usr/pkg/bin/python2.4

import sys
import re
import anita
from optparse import OptionParser

class Usage(Exception):
    def __init__(self, msg):
        self.msg = msg

def main(argv = None):
    if argv is None:
        argv = sys.argv

    parser = OptionParser()
    parser.add_option("--workdir",
		      help="store work files in DIR", metavar="DIR")
    (options, args) = parser.parse_args()

    print "WORKDIR", options.workdir

    if len(args) < 2:
	raise Usage("not enough arguments")

    dist = args[1]
    if re.search(r'\.iso$', dist):
	ver = anita.ISO(dist)
    elif re.match('^[a-z0-9\.0-]+:', dist):
	ver = anita.URL(dist)
    else:
	raise Usage("can't figure out " + dist)

    mode = args[0]
    if mode == 'install':
	ver.install()
    elif mode == 'boot':
	ver.boot()
    elif mode == 'interact':
	ver.interact()
    else:
	raise Usage("unknown mode: " + mode)

if __name__ == "__main__":
    main()

#!/usr/pkg/bin/expect -f

#set dist /usr/build/135/release/i386/installation
set dist /usr/build/136/release/i386/installation

exec qemu-img create hd 512M

spawn qemu -m 32 -hda hd -fda $dist/floppy/boot-com1.fs -cdrom $dist/cdrom/netbsd-i386.iso -boot a -serial stdio -nographic

expect "insert disk 2, and press return..."
send "\001c"
expect "(qemu)"
send "change fda $dist/floppy/boot2.fs\n"
expect "(qemu)"
send "\001c\n"
set timeout -1
expect "a: Installation messages in English"
send "\n"
expect "Keyboard type"
send "\n"
expect "a: Install NetBSD to hard disk"
send "\n"
expect "Shall we continue"
expect "b: Yes"
send "b\n"
expect "I found only one disk"
expect "Hit enter to continue"
send "\n"
expect "a: Full installation"
send "\n"
expect "a: This is the correct geometry"
send "\n"
expect "b: Use the entire disk"
send "b\n"
expect "Do you want to install the NetBSD bootcode"
expect "a: Yes"
send "\n"
#expect "a: Set sizes of NetBSD partitions"
# XXX if you select "b: Use existing partition sizes" here, things go wrong
send "\n"
expect "Accept partition sizes"
send "\016\016\016\016\016\016\016\016\n"
expect "x: Partition sizes ok"
send "\n"
expect "Please enter a name for your NetBSD disk"
send "\n"
expect "Shall we continue"
expect "b: Yes"
send "b\n"
expect "b: Use serial port com0"
# XXX sysinst is inconsistent here
send bx\n"
expect "a: Progress bar"
send "\n"
expect "a: CD-ROM"
send "\n"
expect "x: Continue"
send "x\n"
expect "Hit enter to continue"
send "\n"
expect "Hit enter to continue"
send "\n"
expect "Please choose the timezone"
send "x\n"
expect "a: DES"
send "\n"
expect "root password"
expect "b: No"
send "b\n"
expect "a: /bin/sh"
send "\n"
expect "Hit enter to continue"
send "\n"
expect "x: Exit"
send "x\n"
expect "#"
send "halt\n"
expect "halted by root"

# interact

